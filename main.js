(()=>{"use strict";class e{constructor(e,t){var s,i;i=e=>{e.validity.valid?this._hideError(e):this._showError(e,e.validationMessage)},(s="_checkInputValidity")in this?Object.defineProperty(this,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[s]=i,this._form=t,this._settings=e,this._buttonElement=this._form.querySelector(this._settings.submitButtonSelector),this._inputList=Array.from(this._form.querySelectorAll(this._settings.inputSelector))}_enableSubmitButton(){this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0)}disableSubmitButton(){this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}_checkInputsContent(){return this._inputList.every((e=>0===e.value.length))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()||this._checkInputsContent()?this.disableSubmitButton():this._enableSubmitButton()}_showError(e,t){var s=this._settings,i=s.inputErrorClass,r=s.errorClass,n=this._form.querySelector("#".concat(e.id,"-error"));e.classList.add(i),n.textContent=t,n.classList.add(r)}_hideError(e){var t=this._settings,s=t.inputErrorClass,i=t.errorClass,r=this._form.querySelector("#".concat(e.id,"-error"));e.classList.remove(s),r.textContent="",r.classList.remove(i)}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._toggleButtonState()}enableValidation(){this._setEventListeners()}resetErrors(){this._inputList.forEach((e=>{this._hideError(e)}))}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s,i,r,n){t(this,"removeCard",(()=>{this._cardElement.remove(),this._cardElement=null})),t(this,"_activateLike",(()=>{this._cardLike.classList.add("cards__like_is-active")})),t(this,"_removeLike",(()=>{this._cardLike.classList.remove("cards__like_is-active")})),this._cardTemplate=document.querySelector(s).content,this._name=e.name,this._link=e.link,this._likes=e.likes,this._id=e.id,this._userId=e.userId,this._ownerId=e.ownerId,this._handleCardClick=i,this._handleDeleteClick=r,this._handleLikeClick=n}_fillCard(){this._cardElement.querySelector(".cards__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=this._name}isLiked(){return this._likes.find((e=>e._id===this._userId))}_setEventListeners(){this._cardLike=this._cardElement.querySelector(".cards__like"),this._cardRemove=this._cardElement.querySelector(".cards__remove"),this._cardRemove.addEventListener("click",(()=>{this._handleDeleteClick(this._id)})),this._cardLike.addEventListener("click",(()=>this._handleLikeClick(this._id))),this._cardImage.addEventListener("click",this._handleCardClick)}countLikes(e){this._likes=e,this._cardElement.querySelector(".cards__like-count").textContent=this._likes.length,this.isLiked()?this._activateLike():this._removeLike()}getView(){return this._cardElement=this._cardTemplate.querySelector(".cards__item").cloneNode(!0),this._cardImage=this._cardElement.querySelector(".cards__image"),this._fillCard(),this._setEventListeners(),this.countLikes(this._likes),this._ownerId!==this._userId&&(this._cardRemove.style.display="none"),this._cardElement}}class i{constructor(e){this._popup=document.querySelector(e),this._closePopupByEsc=this._closePopupByEsc.bind(this)}_closePopupByEsc(e){"Escape"===e.key&&this.close()}open(){document.addEventListener("keydown",this._closePopupByEsc),this._popup.classList.add("popup_is-opened")}close(){document.removeEventListener("keydown",this._closePopupByEsc),this._popup.classList.remove("popup_is-opened")}setEventListeners(){var e=this._popup.querySelector(".popup__close");this._popup.addEventListener("click",(t=>{t.target.closest(".popup__container")&&t.target!==e||this.close()}))}}class r extends i{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=[...this._form.querySelectorAll(".popup__field")],this._submitButton=this._form.querySelector(".popup__submit"),this._initialButtonText=this._submitButton.textContent}_getInputValues(){var e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}showLoading(){this._submitButton.textContent="Сохранение..."}returnInitialButtonContent(){this._submitButton.textContent=this._initialButtonText}changeSubmitHandler(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}}var n,o={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__field_type_error",errorClass:"popup__error_visible"},a=document.querySelector(".profile__button_type_edit-description"),c=document.querySelector(".profile__button_type_add-card"),l=document.querySelector(".profile__button_type_edit-user-pic"),d=document.querySelector(".popup__form_type_profile"),_=document.querySelector(".popup__form_type_add-card"),u=document.querySelector(".popup__form_type_edit-user-pic"),h=document.querySelector(".popup__field_type_name"),p=document.querySelector(".popup__field_type_job"),m=document.querySelector(".cards"),v=new class{constructor(e){var t=e.baseUrl,s=e.headers;this._headers=s,this._baseUrl=t}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}editProfile(e,t){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}addCard(e,t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}deleteLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}addLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}changeUserPic(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(e.status))).catch(console.log)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-39",headers:{authorization:"78099c83-b4f6-4327-beb7-a0fa8f52d200","Content-Type":"application/json"}});v.getProfile().then((e=>{console.log(e.name,e.about,e.avatar),y.setUserInfo(e.name,e.about,e.avatar),n=e._id})),v.getInitialCards().then((e=>{e.forEach((e=>{var t=L({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:n,ownerId:e.owner._id});B.addItem(t)}))}));var b=new e(o,d),E=new e(o,_),k=new e(o,u),f=new class extends i{open(e,t){var s=this._popup.querySelector(".popup__image"),i=this._popup.querySelector(".popup__caption");s.src=e,s.alt=t,i.textContent=t,super.open()}}(".popup_type_big-image"),y=new class{constructor(e){var t=e.profileNameSelector,s=e.profileJobSelector,i=e.userPicSelector,r=e.editUserPicButtonSelector;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s),this._userPic=document.querySelector(i),this._editUserPicButton=document.querySelector(r)}_showEditButton(){this._editUserPicButton.style.display="block"}_hideEditButton(){this._editUserPicButton.style.display="none"}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e,t,s){this._nameElement.textContent=e,this._jobElement.textContent=t,this._userPic.style.backgroundImage="url(".concat(s,")")}setEventListeners(){this._userPic.addEventListener("mouseover",(()=>{this._showEditButton()})),this._userPic.addEventListener("mouseout",(()=>{this._hideEditButton()}))}}({profileNameSelector:".profile__title",profileJobSelector:".profile__description",userPicSelector:".profile__user-pic",editUserPicButtonSelector:".profile__button_type_edit-user-pic"});b.enableValidation(),E.enableValidation(),k.enableValidation();var L=e=>{var t=new s(e,"#card-template",(()=>{f.open(e.link,e.name)}),(e=>{g.open(),g.changeSubmitHandler((()=>{v.deleteCard(e).then((()=>{t.removeCard(),g.close()}))}))}),(e=>{t.isLiked()?v.deleteLike(e).then((e=>{t.countLikes(e.likes)})):v.addLike(e).then((e=>{t.countLikes(e.likes)}))}));return t.getView()},S=new r(".popup_type_add-card",(e=>{S.showLoading(),v.addCard(e.place,e.link).then((e=>{var t=L({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:n,ownerId:e.owner._id});B.addItem(t)})).then((()=>{S.close()}))})),g=new r(".popup_type_delete-card"),C=new r(".popup_type_profile",(e=>{C.showLoading();var t=e.name,s=e.occupation;v.editProfile(t,s).then((e=>{y.setUserInfo(e.name,e.about,e.avatar)})).then((()=>{C.close()}))})),I=new r(".popup_type_edit-user-pic",(e=>{I.showLoading();var t=e.link;v.changeUserPic(t).then((e=>{y.setUserInfo(e.name,e.about,e.avatar)})).then((()=>{I.close()}))})),B=new class{constructor(e,t){var s=e.items,i=e.renderer;this._initialArray=s,this._container=t,this._renderer=i}renderElements(){this._initialArray.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:e=>{var t=L(e);console.log("card",t),B.addItem(t)}},m);B.renderElements(),f.setEventListeners(),S.setEventListeners(),C.setEventListeners(),g.setEventListeners(),I.setEventListeners(),y.setEventListeners(),a.addEventListener("click",(function(){C.returnInitialButtonContent();var e=y.getUserInfo();h.value=e.name,p.value=e.job,C.open()})),c.addEventListener("click",(function(){S.returnInitialButtonContent(),E.disableSubmitButton(),E.resetErrors(),S.open()})),l.addEventListener("click",(function(){I.returnInitialButtonContent(),k.disableSubmitButton(),k.resetErrors(),I.open()}))})();